<source>
  @type  forward
  port  24224
</source>

<filter **>
  @type record_transformer
  enable_ruby
  <record>
    hostname ${tag_parts[0]}
    node     ${tag_parts[0]}
    grid     ${tag_parts[1]}
    stack    ${tag_parts[2]}
    service  ${tag_parts[3]}
    instance ${tag_parts[4]}

    message ${record['log']}
  </record>
  remove_keys log
</filter>

<match **>
  @type logzio_buffered
  endpoint_url "https://#{ENV['LOGZIO_HOST']}:#{ENV['LOGZIO_PORT']}?token=#{ENV['LOGZIO_TOKEN']}&type=kontena"
  output_include_time true
  output_include_tags true
  buffer_type    file
  buffer_path    /tmp/logzio
  flush_interval 10s
  buffer_chunk_limit 1m   # Logz.io has bulk limit of 10M. We recommend set this to 1M, to avoid oversized bulks
</match>
